<!DOCTYPE html>
<html>
	<head>
		<meta charset="ISO-8859-1">
		<title>View Courses</title>
		 <!-- Required meta tags -->
	    <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
	
	    <!-- Bootstrap CSS -->
	    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
		<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
		<style>
			    body{
  margin: 0;
  padding: 0;
  font-family: Roboto;
  background-image: url("images/dm.jpg");
  background-size: cover;
  background-repeat: no-repeat;
}

.center{
  position: absolute;
  top: 56%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 29vw;
  background: white;
  border-radius: 10px;
}

.center h1{
  text-align: center;
  padding: 0 0 20px 0;
  border-bottom: 1px solid silver;
}

.center form{
  padding: 0 40px;
  box-sizing: border-box;
}

form .txt_field{
  position: relative;
  border-bottom: 2px solid #adadad;
  margin: 30px 0;
}

.txt_field input{
  width: 100%;
  padding: 0 5px;
  height: 40px;
  font-size: 16px;
  border: none;
  background: none;
  outline: none;
}

.txt_field label{
  position: absolute;
  top: 50%;
  left: 5px;
  color: #adadad;
  transform: translateY(-50%);
  font-size: 16px;
  pointer-events: none;
}

.txt_field span::before{
  content: '';
  position: absolute;
  top: 40px;
  left: 0;
  width: 0px;
  height: 2px;
  background: #2691d9;
  transition: .5s;
}

.txt_field input:focus ~ label,
.txt_field input:valid ~ label{
  top: -5px;
  color: #2691d9;
}

.txt_field input:focus ~ span::before,
.txt_field input:Valid ~ span::before{
  width: 100%;
}

.pass{
  margin: -5px 0 20px 5px;
  color: #a6a6a6;
  cursor: pointer;
}

.pass:hover{
  text-decoration: underline;
}

input[type="Submit"]{
  width: 100%;
  height: 50px;
  border: 1px solid;
  border-radius: 25px;
  font-size: 18px;
  font-weight: 700;
  cursor: pointer;

}

input[type="Submit"]:hover{
  background: #2691d9;
  color: #e9f4fb;
  transition: .5s;
}

.signup_link{
  margin: 30px 0;
  text-align: center;
  font-size: 16px;
  color: #666666;
}

.signup_link a{
  color: #2691d9;
  text-decoration: none;
}

.signup_link a:hover{
  text-decoration: underline;
}

.HomeAbout{
  width: 100vw;
  height: 25vh;
}
header {
  width: 100%;
  height: 100vh;
  background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.15)),
    url("../images/taj.jpg");
  background-repeat: no-repeat;
  background-size: cover;
  position: sticky;
  top: 0;
}

nav {
  width: 100%;
  height: 15vh;
  background: rgba(0, 0, 0, 0.2);
  color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
  text-transform: uppercase;
  position: sticky;
  top: 0;
}

nav .logo {
  width: 25%;
  text-align: center;
  /*background: red;*/
}

nav .menu {
  width: 40%;
  display: flex;
  justify-content: space-around;
  
}

nav .menu a {
  width: 25%;
  text-decoration: none;
  color: white;
  font-weight: bold;
}


@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap');
*{
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: "Poppins" , sans-serif;
}
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500&display=swap');
*{
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}
span{
  color: red;
}
.tbl-header
{
font-family: Mukta, sans-serif;
  height: 35vh;
  display: grid;
  justify-content: center;
  align-items: center;
  color: #4f546c;
  font-size: 1.7rem;
}
table
{
border-spacing: 1; 
  border-collapse: collapse; 
  background:white;
  border-radius:6px;
  overflow:hidden;
  max-width:800px; 
  width:100%;
  margin:0 auto;
  position:relative;
}
table,th,td{
	border: 1px solid black;
	
}
th{
	color: black;
	background-color: #FFED86;
	text-align: center;
	
}
td{
	color: black;
	background-color: floralwhite;
	text-align: center;
	
	}

	</style>
	</head>
	<body>
	<header>
	
      <nav>
        <div class="logo"> <h1 style="font-size: 20px;"> Le<span><b>A</b></span>rn In<span><b>S</b></span>pire</h1> </div>
        <div class="menu">
          <a href="/studentHome">Student Home</a>
          <a href="/login">Logout</a>
        </div>
      </nav>
	<div>
    <!-- Your table -->
    <center>
		<br><br><br><br>
		<div class="tbl-header">
    <table class="table1">
  <thead class="table-header">
  <tr>
    <th scope="col">Course Id</th>
    <th scope="col">Course Name</th>
    <th scope="col">Course Price</th>
    <th scope="col">Buy Course</th> <!-- New column header -->
  </tr>
</thead>
<tbody>
  <tr th:each="course : ${courseList}">
    <td th:text="${course.courseId}"></td>
    <td th:text="${course.courseName}"></td>
    <td th:text="${course.coursePrice}"></td>
    
    <td>
    	<form id="payment-form">
    		<input type="hidden" class="email" th:value="${session.loggedInUser.email}"/>
    		<input type="hidden" class="course-id" th:value="${course.courseId}"/>
	        <button type="submit" id="pay-button" class="btn btn-success buy-button" th:data-amount="${course.coursePrice}">BUY</button>
	    </form>
    </td> <!-- New column with Buy button -->
  </tr>
</tbody>

<br>



</table>
</center>
</div>
</div>
	</header>

<script>
$(document).ready(function() {
    $(".buy-button").click(function(e) {
        e.preventDefault();
        var form = $(this).closest('form');
        var amount = $(this).data("amount");
        var email = form.find('.email').val();
        var courseId = form.find('.course-id').val();
        createOrder(amount, email, courseId);
    });
});

function createOrder(amount, email, courseId) {
	alert(amount+email+courseId)
    $.post("/takeOrder", { amount: amount, email: email, courseId: courseId })
        .done(function(order) {
            order = JSON.parse(order);
            var options = {
                "key": "rzp_test_mr1YAIU9F4ah0V",
                "amount": order.amount_due.toString(),
                "currency": "INR",
                "name": "Learn Sphere",
                "description": "Test Transaction",
                "order_id": order.id,
                "handler": function (response) {
                    verifyPayment(response.razorpay_order_id, response.razorpay_payment_id, response.razorpay_signature);
                },
                "prefill": {
                    "name": "Your Name",
                    "email": "test@example.com",
                    "contact": "9999999999"
                },
                "notes": {
                    "address": "Your Address"
                },
                "theme": {
                    "color": "#F37254"
                }
            };
            var rzp1 = new Razorpay(options);
            rzp1.open();
        })
        .fail(function(error) {
            console.error("Error:", error);
        });
}

function verifyPayment(orderId, paymentId, signature) {
     $.post("/verify", { orderId: orderId, paymentId: paymentId, signature: signature })
         .done(function(isValid) {
             if (isValid) {
                 console.log("Payment successful");
             } else {
                 console.log("Payment failed");
             }
         })
         .fail(function(error) {
             console.error("Error:", error);
         });
}
</script>
	
	
	
	
</html>		